<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Jade Delight</title>
</head>
    
<body onload = "zeroCost()">

    <script language="javascript">
    
    function MenuItem(name, cost)
    {
        this.name = name;
        this.cost=cost;
    }
    
    menuItems = new Array(
        new MenuItem("Chicken Chop Suey", 4.5),
        new MenuItem("Sweet and Sour Pork", 6.25),
        new MenuItem("Shrimp Lo Mein", 5.25),
        new MenuItem("Moo Shi Chicken", 6.5),
        new MenuItem("Fried Rice", 2.35)
    );
    
    function makeSelect(name, minRange, maxRange)
    {
        var t= "";
        t = "<select name='" + name + "' size='1' onchange= 'displayAmount(this.value, this.name)'>";
        for (j=minRange; j<=maxRange; j++)
           t += "<option>" + j + "</option>";
        t+= "</select>"; 
        return t;
    }

    function zeroCost(){
        zero = 00;
        for(i = 0; i < menuItems.length; i++){
            document.getElementsByName('cost')[i].value = zero.toFixed(2);
        }
        document.getElementsByName('subtotal')[0].value = zero.toFixed(2);
        document.getElementsByName('tax')[0].value = zero.toFixed(2);
        document.getElementsByName('total')[0].value = zero.toFixed(2);
    }

    function displayAmount(quantity, menu_item){
        row = menu_item[menu_item.length-1];
        menu = menuItems[row].cost * quantity;
        document.getElementsByName('cost')[row].value = menu.toFixed(2);

        subtotal = 0;
        for(i = 0; i < menuItems.length; i++){
            itemCost = document.getElementsByName('cost')[i].value;
            subtotal += parseFloat(itemCost);
        }

        document.getElementById("subtotal").value = subtotal.toFixed(2);
        document.getElementById("tax").value = (subtotal*.0625).toFixed(2);
        document.getElementById("total").value = (subtotal*1.0625).toFixed(2);
    }

    function checkLName(){
        lastName = document.getElementsByName("lname")[0].value;
        // white space
        lastName = lastName.replace(/^\s+|\s+$/g, '');
        if (lastName == "") {
            document.getElementById("lnIssue").innerHTML = "*Please fill in last name";
            return false;
        }
        document.getElementById("lnIssue").innerHTML = null;
        return true;
    }

    function checkPhone(){
        pNum = document.getElementsByName("phone")[0].value;
        if(pNum == ""){
            document.getElementById("pIssue").innerHTML = "Please fill in your phone #";
            return false;
        }
        if(pNum.length != 12 || pNum[3] != "-" || pNum[7] != "-" ){
            document.getElementById("pIssue").innerHTML = "Please fill in valid phone # (xxx-xxx-xxxx)";
            return false;
        }
        document.getElementById("pIssue").innerHTML = null;
        return true;
    }

    function checkStreet(){
        street = document.getElementsByName('street')[0].value;
        if(street == ""){
            document.getElementById("sIssue").innerHTML = "Please enter your street for delivery";
            return false;
        }
        document.getElementById("sIssue").innerHTML = null;
        return true;
    }

    function checkCity(){
        city = document.getElementsByName('city')[0].value;
        if(city == ""){
            document.getElementById("cIssue").innerHTML = "Please enter your city for delivery";
            return false;
        }
        document.getElementById("cIssue").innerHTML = null;
        return true;
    }

    expectedTime = new Date();
    min = expectedTime.getMinutes();
    hour = expectedTime.getHours();

    function confirm(){
        if(document.getElementsByName("p_or_d")[0].checked){
            validName = checkLName();
            validPhone = checkPhone();
            if(validName == true && validPhone == true){
                min = min + 15;
            }
            else{
                return false;
            }
        }
        if(document.getElementsByName("p_or_d")[1].checked){
            validName = checkLName();
            validPhone = checkPhone();
            validStreet = checkStreet();
            validCity = checkCity();
            
            if(validName == true && validPhone == true && validCity == true && validStreet == true){
                min = min + 30;
            }
            else{
                return false;
            }

        }
        if(min >= 60){
            min = min - 60;
            hour++;
            if(hour == 24){
                hour = 0;
            }
        }

        // !!confusion!!
        hour = ("0" + hour).slice(-2);
        min = ("0" + min).slice(-2);
        orderTime = hour + ":" + min;

        if(document.getElementsByName("p_or_d")[0].checked){
            alert("Thanks for your order. It will be ready for pick up at " + orderTime + " and will cost $" + document.getElementsByName("total")[0].value);
            return true;
        }
        if(document.getElementsByName("p_or_d")[1].checked){
            alert("Thanks for your order. It will be delivered at " + orderTime + " and will cost $" + document.getElementsByName("total")[0].value);
            return true;
        }
    }

    </script>
    <!-- end of javascript tings -->
    <h1>Jade Delight</h1>
    
    <form onsubmit="return confirm()">
    <p>First Name: <input type="text" name="fname"></p>
    <p>Last Name*:  <input type="text" id = "lnIssue" name="lname"></p>
    <p>Street: <input type="text" id = "sIssue"name="street"></p>
    <p>City: <input type="text" id = "cIssue" name="city"></p>
    <p>Phone*: <input type="text" id = "pIssue" name="phone"> Format: xxx-xxx-xxxx</p>
    <p> 
        <input type="radio" name="p_or_d" value="pickup" checked="checked">Pickup  
        <input type="radio" name="p_or_d" value="delivery">
        Delivery
    </p>

    <table border="0" cellpadding="3">
      <tr>
        <th>Select Item</th>
        <th>Item Name</th>
        <th>Cost Each</th>
        <th>Total Cost</th>
      </tr>

    <script language="javascript">
    
      var s = "";
      for (i=0; i< menuItems.length; i++)
      {
          s += "<tr><td>";
          s += makeSelect("quan" + i, 0, 10);
          s += "</td><td>" + menuItems[i].name + "</td>";
          s += "<td> $ " + menuItems[i].cost.toFixed(2) + "</td>";
          s += "<td>$<input type='text' name='cost'/></td></tr>";
      }
      document.writeln(s);
    </script>
    </table>

    <p>Subtotal: 
       $<input type="text" name="subtotal" id="subtotal">
    </p>
    <p>Mass tax 6.25%:
      $ <input type="text" name="tax" id="tax">
    </p>
    <p>Total: $ <input type="text" name="total" id="total">
    </p>
    
    <input type="button" value="Submit Order" onclick="getOrderTime()">
    
    </form>
    
    </body>
    
    </html>
